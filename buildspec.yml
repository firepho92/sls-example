version: 0.2
phases:
  install:
    commands:
      - node -v
      - yarn
      - yarn global add serverless@3.27.0
      - sls -v
      - cd layers/lib/nodejs
      - yarn --prod
      - cd ../../..
      - cd layers/db/nodejs
      - yarn --prod
      - cd ../../..
      - snyk test --on-fail=all
      - snyk monitor --org=f7b6de39-69ab-4df6-a882-9b9b8a7f332e
  build:
    commands:
      - echo $Stage
      - serverless deploy --stage $Stage --max-concurrency 10
